<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style2.css">
    <title>Smart contract</title>
</head>
<body class="body">

<div class="box-0">
    <h1 class="heading">Topic to be added in contract</h1>
</div>
<div class="box-1">
    <div class="container01">
        <form action="" class="form" onsubmit="submitForm(event)">
            <label for="value" style="color: beige;">Value:</label>
            <input type="text" id="value" name="value" placeholder="Enter value..">

            <label for="time" style="color: beige;">Time:</label>
            <input type="number" id="time" name="time" placeholder="Enter Time in seconds">

            <label for="topic" style="color: beige;">Topic Name:</label>
            <input type="text" id="topic" name="topic" placeholder="Enter topic..">

            <label for="address" style="color: beige;">Address:</label>
            <input type="text" id="address" name="address" placeholder="Enter address..">

            <input type="submit" value="Submit">
            
        </form>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
<script>
    async function submitForm(event) {
        event.preventDefault();

        // Connect to MetaMask (assuming it's installed and unlocked)
        if (window.ethereum) {
            window.web3 = new Web3(window.ethereum);
            try {
                // Request account access if needed
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                console.log('Connected to MetaMask');
            } catch (error) {
                console.error('User denied account access:', error);
                return;
            }
        } else {
            console.error('Please install MetaMask to interact with the contract');
            return;
        }

        const contractAddress = '0x83328E797bF271EA022ceB5A6Cb2E4aFA0E9B092'; // Replace with your contract address
        const contractAbi = [{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_target",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_deadline",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "contributors",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_description",
				"type": "string"
			},
			{
				"internalType": "address payable",
				"name": "_recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "createRequests",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "deadline",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getContractBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_requestNo",
				"type": "uint256"
			}
		],
		"name": "makePayment",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "manager",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minimumContribution",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "noOfContributors",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "numRequests",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "raisedAmount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "refund",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "requests",
		"outputs": [
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			},
			{
				"internalType": "address payable",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "completed",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "noOfVoters",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "sendEth",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "target",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_requestNo",
				"type": "uint256"
			}
		],
		"name": "voteRequest",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	} ]; // Replace with your contract ABI
        
        const contract = new web3.eth.Contract(contractAbi, contractAddress);

        // Get form input values
        const value = document.getElementById('value').value;
        const time = document.getElementById('time').value;
        const topic = document.getElementById('topic').value;
        const address = document.getElementById('address').value;

        // Perform contract interaction (example: calling a contract function)
        try {
            const accounts = await web3.eth.getAccounts();
            const account = accounts[0];

            // Example call to a contract function
            const result = await contract.methods.createRequests(topic, address, value)
                .send({ from: account, gas: '6721975' }); // Adjust gas limit as needed

            console.log('Transaction successful:', result);
            // Display success message on the frontend
            
        } catch (error) {
            console.error('Error interacting with the contract:', error);
            
        }
    }
</script>

</body>
</html>
